<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Build your own Vagrant Boxes with VeeWee | Phil Sturgeon</title>
  <meta name="description" content="I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.png" rel="icon" type="image/png" />

  <meta property="og:title" content="Build your own Vagrant Boxes with VeeWee" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="The other day I posted an article about upgrading Chef and Vagrant, and the pains you can end up having by relying on third-party vagrant boxes instead of building your own with VeeWee. 
 
Getting started was initially confusing to me, as I knew VeeWee was a gem, so I just tried installing it directly into my application gemset. The trouble here is that VeeWee depends on the Vagrant gem version v1.0.x and Vagrant is now not only on 1.2.2 but not actually a gem anymore." />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/devops/2013/05/05/build-your-own-vagrant-boxes-with-veewee/" />
  <meta property="og:locale" content="en_GB" />
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="Build your own Vagrant Boxes with VeeWee | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/devops/2013/05/05/build-your-own-vagrant-boxes-with-veewee/">
  <meta name="twitter:description" content="The other day I posted an article about upgrading Chef and Vagrant, and the pains you can end up having by relying on third-party vagrant boxes instead of building your own with VeeWee. 
 
Getting started was initially confusing to me, as I knew VeeWee was a gem, so I just tried installing it directly into my application gemset. The trouble here is that VeeWee depends on the Vagrant gem version v1.0.x and Vagrant is now not only on 1.2.2 but not actually a gem anymore.">
  <meta name="twitter:creator" content="@philsturgeon">
  
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Build your own Vagrant Boxes with VeeWee</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2013-05-05 18:57:00 UTC">
                May  5 2013
              </time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>The other day I posted an article about <a href="/blog/2013/04/vagrant-and-chef-upgrade-party">upgrading Chef and Vagrant</a>, and the pains you can end up having by relying on third-party vagrant boxes instead of building your own with <a href="https://github.com/jedi4ever/veewee">VeeWee</a>.</p>

<p>Getting started was initially confusing to me, as I knew VeeWee was a gem, so I just tried installing it directly into my application gemset. The trouble here is that VeeWee depends on the Vagrant gem version v1.0.x and Vagrant is now not only on 1.2.2 but not actually a gem anymore.</p>

<h2 id="step-1-create-a-veewee-area">Step 1: Create a “VeeWee” area</h2>

<p>So, to get going the best thing to do is clone the VeeWee repo, which creates a new RVM gemset for you. This is a whole separate are probably in ~/Development or something:</p>

<pre class="highlight plaintext"><code>git clone git@github.com:jedi4ever/veewee.git
</code></pre>

<h2 id="step-2-install-dependencies">Step 2: Install Dependencies</h2>

<p>When this is done if you have RVM set up to check for .rvmrc files it will ask you if you wish to trust this new gemset. If you see this, hit “y” to approve. If this message is not displayed (because you are not looking for .rvmrc files) then go and <a href="https://rvm.io/rvm/install/">set that up</a>. It should be something like:</p>

<pre class="highlight plaintext"><code>echo "source $HOME/.rvm/scripts/rvm" &gt;&gt; ~/.bash_profile
</code></pre>

<p>With your gemset alive, you may well be told you need to install Ruby 1.9.2, which may or may not work:</p>

<pre class="highlight plaintext"><code>rvm install ruby-1.9.2-p320
</code></pre>

<p>On my work laptop it failed to find a build for this version of OSX. In this scenario RVM should try to build the correct version of Ruby from source, but it just threw its toys out of the pram and slapped me with a “Tough shit, go home.” error of some description.</p>

<p>To get around this I just tweaked the .rvmrc file to use 1.9.3, which has seemed to work without issue so far.</p>

<p><em>I’ve sent that version bump in as a <a href="https://github.com/jedi4ever/veewee/pull/668">pull request</a>, so it should be solved in the next version.</em></p>

<p>Pop back out of the folder and back in:</p>

<pre class="highlight plaintext"><code>cd ..
cd veewee
</code></pre>

<p>This is a janky way to get your command line using the gemset, as it will have failed earlier due to lack of Ruby. There’s probably a quicker way, but I don’t care enough to Google it.</p>

<p>Now install the gems VeeWee requires with bundler:</p>

<pre class="highlight plaintext"><code>bundle install
</code></pre>

<h2 id="step-3-building-your-box">Step 3: Building your Box</h2>

<p>This section is pretty much just a regurgitation of the wonderful documentation found <a href="https://github.com/jedi4ever/veewee/blob/master/doc/vagrant.md">here</a>.</p>

<p>See what templates are available:</p>

<pre class="highlight plaintext"><code>bundle exec veewee vbox templates | grep -i ubuntu
</code></pre>

<p>Give up and use Ubuntu for everything:</p>

<pre class="highlight plaintext"><code>bundle exec veewee vbox define 'quantal64' 'ubuntu-12.10-server-amd64'
</code></pre>

<p>Kick off the build process. Once you’ve confirmed the download you might as well go for a walk, because it will be going for close to an hour:</p>

<pre class="highlight plaintext"><code>bundle exec veewee vbox build 'quantal64' 
</code></pre>

<p>That is the worst of it done. Export just builds up the box and shoves it in the working directory:</p>

<pre class="highlight plaintext"><code>bundle exec veewee vbox export 'quantal64'
</code></pre>

<p>Then add it to Vagrant:</p>

<pre class="highlight plaintext"><code>vagrant box add 'quantal64' 'quantal64'
</code></pre>

<p>I already had a box with this name, so I just killed it off then re-ran the box add:</p>

<pre class="highlight plaintext"><code>rm -rf ~/.vagrant.d/boxes/quantal64 
</code></pre>

<h2 id="step-4-put-the-box-somewhere-useful">Step 4: Put the .box somewhere useful</h2>

<p>This step depends on how you’re doing things. The VeeWee docs suggest you can just do:</p>

<pre class="highlight plaintext"><code>cd ~/Development/myapp
vagrant init 'quantal64'
vagrant up	
</code></pre>

<p>If you’re creating a new Vagrant dev environment from scratch then this is no doubt fine, but for me I was replacing an <a href="https://github.com/pyrocms/devops-vagrant">existing setup</a> for PyroCMS. This made it a little more tricky, but not much.</p>

<p>We used to reference a random .box from somebodies GitHub profile, found via VagrantBox.es. I figured I could just shove this on Dropbox, but first I wanted to see if I could put a local filepath into the box_url property. Luckily, you can!</p>

<p>In your <em>Vagrantfile</em> add this:</p>

<pre class="highlight ruby"><code><span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"quantal64"</span>
<span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"/Users/phil/Development/veewee/quantal64.box"</span>
</code></pre>

<p>Now boot your box:</p>

<pre class="highlight plaintext"><code>vagrant up
</code></pre>

<p>It will copy from your hard-disk (much quicker than over the network) and hopefully boot just fine.</p>

<p>After you’ve tested your box locally you can shove it on some network share, or internal URL, or Dropbox, or whatever, so you, your friends/colleagues/minions can work with the exact same box as you.</p>

        </section>
        <footer class="post-footer">
            <section class="share">
                  <a class="icon-twitter" href="https://twitter.com/share?text=Build your own Vagrant Boxes with VeeWee&amp;url=https://philsturgeon.uk/devops/2013/05/05/build-your-own-vagrant-boxes-with-veewee/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                  <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                  </a>
                  <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=Build your own Vagrant Boxes with VeeWee&amp;u=https://philsturgeon.uk/devops/2013/05/05/build-your-own-vagrant-boxes-with-veewee/"
                    onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                  <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                  </a>
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/php/2013/05/01/testing-contributing-composer-packages/">Testing and Contributing with Composer Packages</a>
                </p>
                <p style="float:right">
                    Next: 
                    <a class="button" href="/cycling/2013/05/06/bike-to-the-beach-2013/">Bike to the Beach 2013</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">I spend a lot of time urging people to learn more languages, and if that is a bit much learn another framework. Rails and Laravel are the same, and Go is a barrel of laughs.</p>
              <p>Get out of your rut.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';

          var disqus_identifier = 'build-your-own-vagrant-boxes-with-veewee';

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/ciderphpants.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/'>GitHub</a>
      </li>
      <li>
        <a href='http://phptownhall.com/'>PHP Town Hall</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/http/2015/09/23/http-status-codes-are-not-enough/">HTTP Status Codes Are Not Enough</a></li>
          <li><a href="/http/2015/09/03/auto-incrementing-to-destruction/">Auto-Incrementing IDs: Giving your Data Away</a></li>
          <li><a href="/charity/2015/08/22/no-booze/">No Booze for a Month</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
