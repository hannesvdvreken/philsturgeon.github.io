<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Auto-Incrementing IDs: Giving your Data Away | Phil Sturgeon</title>
  <meta name="description" content="I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.png" rel="icon" type="image/png" />

  <meta property="og:title" content="Auto-Incrementing IDs: Giving your Data Away" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="Something we’re always taught as developers, usually by tutorials or via the defaults in various ORM tools, is every SQL table needs an auto-incrementing ID. This is a weirdly common fallacy, enforced by old tutorials, new tutorials and half-arsed tooling in various forms. Why are auto-incrementing IDs a problem? Because it means people can download your database." />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/http/2015/09/03/auto-incrementing-to-destruction/" />
  <meta property="og:locale" content="en_GB" />
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="Auto-Incrementing IDs: Giving your Data Away | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/http/2015/09/03/auto-incrementing-to-destruction/">
  <meta name="twitter:description" content="Something we’re always taught as developers, usually by tutorials or via the defaults in various ORM tools, is every SQL table needs an auto-incrementing ID. This is a weirdly common fallacy, enforced by old tutorials, new tutorials and half-arsed tooling in various forms. Why are auto-incrementing IDs a problem? Because it means people can download your database.">
  <meta name="twitter:creator" content="@philsturgeon">
  
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Auto-Incrementing IDs: Giving your Data Away</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2015-09-03 13:47:00 UTC">
                Sep  3 2015
              </time>
              <a href="/tags/http/">#http</a>
              <a href="/tags/api/">#api</a>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>Something we’re always taught as developers, usually by tutorials or via the defaults in various ORM tools, is every SQL table needs an auto-incrementing ID. This is a weirdly common fallacy, enforced by old tutorials, new tutorials and half-arsed tooling in various forms. Why are auto-incrementing IDs a problem? Because it means people can download your database.</p>

<p>This is not a new problem, it’s been covered well over the last twenty years, but it is a problem I tell people about in my API talks and it seems new to many. People want to know how to avoid it, and how API data can ever be safe.</p>

<h2 id="a-case-study">A Case Study</h2>

<p>I contracted for a startup going through an accelerator, where one of the teams were building a unique database of user-generated photographs, and these photos were of artwork. Artwork like awesome graffiti, unknown installations, etc., and this data was not available anywhere else on the Internet.</p>

<p>They had these two URLs on their API:</p>

<ol>
  <li><code>GET /artworks/234</code></li>
  <li><code>GET /users/6138</code></li>
</ol>

<p>What are the problems here?</p>

<h3 id="leaking-success-to-competitors">Leaking “Success” to Competitors</h3>

<p>As a startup, you often have competitors. Letting those competitors know the size of your data set, and how many users you have in your system, could lead to some pretty embarrassing situations.</p>

<p>Looking at the URL <code>GET /users/6138</code>, I can go to <code>GET /users/1</code>. If that shows me data, I can reasonably assume they have <em>at least</em> 6138 users, but to find the total I can easily make a script that <code>++$id</code> and counts every HTTP status <code>200</code>, and also counts things like 404 or 410, to give a accurate number of how many active users there are, and how many closed their account.</p>

<p>That could embarrass a larger company, or utterly destroy a small startup.</p>

<h3 id="leaking-datasets-to-competitors-or-assholes">Leaking Datasets to Competitors (or Assholes)</h3>

<p>Leaking statistics to your enemies might not be something that keeps you up at night, but what about giving away your actual data?</p>

<p>In our case study, these people had unique data, available nowhere else. If other people want this data, they can use the same <code>++$id</code> approach to grab a hold of that data, and populate their own app, making a new competitor quite easily, and with a slightly better app could potentially put them out of business.</p>

<p>Balls.</p>

<h2 id="alternatives">Alternatives</h2>

<p>There are some alternatives to this, which can be used in pretty much any scenario.</p>

<h3 id="id-obfuscation">ID Obfuscation</h3>

<p>If you’re stuck with 1, 2, 3 in your DB due to a picky ORM, or due to not wanting to change an existing schema and all the data that goes with it, you can keep your IDs and just “hide” them.</p>

<p>Obfuscation allows you to turn a <code>1</code> into a <code>"df234FSafd"</code> and a <code>"p363fdte7"</code> into a <code>2364</code>. Your IDs stay the same, but the user cannot <code>++$id</code> anymore because <code>"df234FSafd" + 1</code> isn’t a thing.</p>

<p>They use a hidden secret key, without which the strings are not reversible, so they’re relatively safe.</p>

<p><strong>PHP</strong></p>

<ul>
  <li><a href="https://github.com/zackkitzmiller/tiny-php/">Tiny</a> - based on code used by <a href="http://zurb.com/forrst">Forrst</a>, and built by the excellent <a href="https://twitter.com/zackkitzmiller">Zack Kitzmiller</a></li>
</ul>

<p><strong>Ruby</strong></p>

<ul>
  <li><a href="https://github.com/namick/obfuscate_id">obfuscate_id</a> - Rails only sorry other people, but looks good</li>
</ul>

<p><strong>Python</strong></p>

<ul>
  <li><a href="https://github.com/marekweb/opaque-id">Opaque ID</a> - Obfuscation for integer IDs</li>
</ul>

<p><strong>JavaScript, Python, Ruby, PHP, Java, Scala, Perl, Swift, Clojure, Objective-C, C, C++11, Go, Erlang, Lua, Haskell, Elixir, Rust, ColdFusion, Groovy, Kotlin, Nim, VBA, ActionScript, CoffeeScript, Bash and for Node.js &amp; .NET</strong></p>

<ul>
  <li><a href="http://hashids.org/">HashIDs</a> - Apparently they’re not so secure and the salt can be guessed from about 30 hashes, so probably don’t use them, but if you’re stuck for anything else…</li>
</ul>

<h3 id="universally-unique-ids">Universally Unique IDs</h3>

<p>UUID is a cool way to make some really unique identifiers for your records, without relying on the DB to auto-increment to make it unique.</p>

<p>These can be used in place of usual IDs. They look a little bit like this:</p>

<blockquote>
  <p>de305d54-75b4-431b-adb2-eb6b9e546014</p>
</blockquote>

<p>That, again, is not <code>++$id</code>-able.</p>

<p>On top of that, two records made at the exact same split second will not have the same UUID, which is where the “universally” bit comes in. You can use this for offline support, meaning you make an item locally, give it an UUID, then sync up with the database when your user gets out of the subway and you’ve maintained integrity of your IDs and your data at large.</p>

<p><strong>Update:</strong> Performance for UUIDs was brought up on Twitter, and there is a common misconception that UUIDs are slow or terrible. Firstly, do not store UUIDs as a string (varchar or char). Store them as binary, and if you use something that prefers PKs to be ordered then you can use <a href="https://www.percona.com/blog/2014/12/19/store-uuid-optimized-way/">ordered UUIDs</a>.</p>

<p><strong>PHP</strong></p>

<ul>
  <li><a href="https://packagist.org/packages/ramsey/uuid">ramsey/uuid</a> - PHP 5.4+ library for generating RFC 4122 version 1, 3, 4, and 5 UUIDs</li>
</ul>

<p><strong>Ruby</strong></p>

<ul>
  <li><a href="http://ruby-doc.org/stdlib-2.2.3/libdoc/securerandom/rdoc/SecureRandom.html#method-c-uuid">SecureRandom.uuid</a> - Built in!</li>
</ul>

<p><strong>Python</strong></p>

<ul>
  <li><a href="https://docs.python.org/2/library/uuid.html">uuid</a> - Built in!</li>
</ul>

<h2 id="but-if-your-app-can-get-it-so-can-the-user">But if your app can get it, so can the user</h2>

<p>Maybe, but how do your users get to the data?</p>

<p>In the case of pageable content, like a “Recent Events” list, simply limit the history of the data you can search through to a few days.</p>

<p>In the case of geo data searched for by proximity (stuff near you), set a limit on the number of records that can be returned, and how far out they can zoom. They’d have to script a bot to get it all which would take a while and is something you can probably program to detect.</p>

<p>Also rate limiting. If you require folks to register an app, you can limit their credentials on the free tier to stop them downloading everything.</p>

<p>Then, if they do start trying to download your whole data set, it’ll at least take them a long time, and again, hopefully give you a chance to notice suspect activity.</p>

<p>How? Look for apps regularly hitting their rate limit. Look for stuff that is randomly search geo boxes moving across the map in an unnatural way (people don’t move in a sweeping left to right grid pattern).</p>

<p>Automate those detections, and fire off an email to the bastards trying to download your dataset. You’ll have their email because they signed up, and if they’re really daft they’ll use their work email. I’ve seen that happen, and we had a nice little chat.</p>

          <hr>
<p>If you're interested in API development and want to hang out with other developers who share your interests, swing by the <a href="https://slack.apisyouwonthate.com/?utm_source=philsturgeon.uk&utm_content=api-tag-footer">APIs You Won't Hate Slack Channel</a>. It's a community of over 300 developers who help each other out, and chat about HTTP, REST and APIs.</p>

        </section>
        <footer class="post-footer">
            <section class="share">
                  <a class="icon-twitter" href="https://twitter.com/share?text=Auto-Incrementing IDs: Giving your Data Away&amp;url=https://philsturgeon.uk/http/2015/09/03/auto-incrementing-to-destruction/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                  <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                  </a>
                  <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=Auto-Incrementing IDs: Giving your Data Away&amp;u=https://philsturgeon.uk/http/2015/09/03/auto-incrementing-to-destruction/"
                    onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                  <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                  </a>
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/charity/2015/08/22/no-booze/">No Booze for a Month</a>
                </p>
                <p style="float:right">
                    Next: 
                    <a class="button" href="/http/2015/09/23/http-status-codes-are-not-enough/">HTTP Status Codes Are Not Enough</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">I spend a lot of time urging people to learn more languages, and if that is a bit much learn another framework. Rails and Laravel are the same, and Go is a barrel of laughs.</p>
              <p>Get out of your rut.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';


          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/ciderphpants.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/'>GitHub</a>
      </li>
      <li>
        <a href='http://phptownhall.com/'>PHP Town Hall</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/2015/11/20/deploying-with-git-flow-tags-and-circleci/">Deploying with Git-Flow, Tags and CircleCI</a></li>
          <li><a href="/api/2015/10/08/http-documentation-with-api-blueprint/">HTTP Documentation with API Blueprint</a></li>
          <li><a href="/2015/10/02/everyones-favourite-twitter-character/">Everyones Favourite Twitter Characters</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
