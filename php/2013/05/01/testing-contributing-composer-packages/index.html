<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Testing and Contributing with Composer Packages | Phil Sturgeon</title>
  <meta name="description" content="I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />

  <meta property="og:name" content="Phil Sturgeon">
  <meta property="og:image" content="/images/author.jpg">
  <meta property="og:description" content="While Composer has been around for a while now, many packages are still in their infancy (< 1.0) or sometimes are just not as feature filled as they could be. To be fair there is always more to be done. It can always do more, or do the same thing more efficiently.">
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="Testing and Contributing with Composer Packages | Phil Sturgeon">
  <meta name="twitter:creator" content="@philsturgeon">
  <meta name="twitter:image:src" content="/images/author.jpg">
  <meta name="twitter:description" content="While Composer has been around for a while now, many packages are still in their infancy (< 1.0) or sometimes are just not as feature filled as they could be. To be fair there is always more to be done. It can always do more, or do the same thing more efficiently.">
  
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>
<div class='teaserimage'>
  <div class='teaserimage-image' style='background-image: url(/images/ciderphpants.jpg)'>
    Sunny and Umoja got on the cider
  </div>
</div>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Testing and Contributing with Composer Packages</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2013-05-01 18:24:00 UTC">
                May  1 2013
              </time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>While Composer has been around for a while now, many packages are still in their infancy (&lt; 1.0) or sometimes are just not as feature filled as they could be. To be fair there is always more to be done. It can always do more, or do the same thing more efficiently.</p>

<p>Whatever the case, pull requests are going to be a common thing for the PHP community to be doing to these packages and this needs to be done safely, with unit-testing.</p>

<p>So, how do you run their test suite and add your own tests?</p>

<h2 id="composer-the-composer">Composer the Composer</h2>

<p>You want to go two levels deep for this one and install composer inside the package itself:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2</pre></td><td class="code"><pre>cd myapp/vendor/laravel/framework
curl -sS https://getcomposer.org/installer | php
</pre></td></tr></tbody></table>
</div>

<p>If you’ve installed Composer globally by renaming it to /usr/bin/composer then you can skip that of course.</p>

<p>Then you want to run Composer and have it install all of the packages dependencies. Normally these will be lumped into your main <code>myapp/vendor/</code> folder when you run the main composer install, but this will just install all the packages and any dev stuff it needs to complete its unit tests in the current directory:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>./composer.phar install --dev
</pre></td></tr></tbody></table>
</div>

<h2 id="testing-the-package">Testing the Package</h2>

<p>With the –dev dependencies installed you can easily run whatever test suite the package developer has set up - which is most likely (at the very least) going to be PHPUnit.</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>./vendor/bin/phpunit
</pre></td></tr></tbody></table>
</div>

<p>This should run their tests, as long as the core of the package has a phpunit.xml file. If the phpunit.xml is elsewhere (maybe in a build/ folder for Jenkins or whatever) then simply reference the location with the -c option:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>./vendor/bin/phpunit -c build/phpunit.xml
</pre></td></tr></tbody></table>
</div>

<p>It’s important to run this before you start faffing around with their code, because writing your own code gets much more difficult if theirs is not even working.</p>

<p>If you get a red before doing anything fix that, THEN work on your own feature (or give up an find a better package, whichever).</p>

<h2 id="adding-tests">Adding Tests</h2>

<p>Got a green light? Awesome.</p>

<p>In which order you do the next bit is pretty unimportant, but I like to write the test first, then write the code:</p>

<div class="highlight php"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14</pre></td><td class="code"><pre>public function testSort()
{
    $data = new Collection(array(5, 3, 1, 2, 4));
    $data-&gt;sort(function($a, $b)
    { 
        if ($a === $b)
        {
            return 0;
        }
        return ($a <span class="err">&lt;</span> $b) ? -1 : 1;
    });

    $this-&gt;assertEquals(range(1, 5), array_values($data-&gt;all()));
}
</pre></td></tr></tbody></table>
</div>

<p>This was just some new method for Laravel 4’s Support\Collection class which lets you uasort() on a Collection. Not rocket science, but Taylor isn’t going to merge this without tests, mostly because he knows what I’m like.</p>

<p>Running that gives me a big old red light, because the method doesn’t even exist. So, I write the method, muddle through a few errors and then it goes green. YAAAAY!</p>

<h2 id="sending-the-pull-request">Sending the Pull Request</h2>

<p>You’ve written the feature. Time to share it with the world!</p>

<p>Go to the main repo (in this case github.com/laravel/framework) and click Fork. Copy the Git+SSH URL then hop into the terminal and do this:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>git checkout -b feature/kittens
git add src/Fluffy.php src/Snuggles.php
git commit -m "More kittens."
git push git@github.com:philsturgeon/framework.git feature/kittens
</pre></td></tr></tbody></table>
</div>

<p>Refresh your repo page and you’ll see a Pull Request button next to the branch you just pushed. Click that, write a message, done.</p>

<h2 id="using-your-fork">Using your fork</h2>

<p>There is going to be some time in between you submitting this pull request and it getting merged into a release for you to use, and you need to be ok with that. Some projects merge quick, some take longer. Sometimes its because the package has slow release cycles, and sometimes the person in charge is just an asshole. Who knows!</p>

<p>Composer is completely ready to help you out here either way.</p>

<div class="highlight javascript"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13</pre></td><td class="code"><pre><span class="p">{</span>
    <span class="s2">"repositories"</span><span class="err">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"vcs"</span><span class="p">,</span>
            <span class="s2">"url"</span><span class="p">:</span> <span class="s2">"git://github.com/philsturgeon/framework.git"</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">"require"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"laravel/framework"</span><span class="err">:</span> <span class="s2">"dev-feature/kittens"</span><span class="p">,</span>
		<span class="s2">"other/stuff"</span> <span class="err">:</span> <span class="s2">"1.0.*@stable"</span>
    <span class="p">},</span>
    <span class="s2">"minimum-stability"</span><span class="err">:</span> <span class="s2">"dev"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table>
</div>

<p>Now when you composer update you’re going to find yourself using your version of the code, not theirs. This means you can wait as long as it takes to do it.</p>

<p>You can even merge all of these individual branches into the master branch of your fork, so you can use all your changes at the same time without mushing them into the same PR.</p>

        </section>
        <footer class="post-footer">
            <section class="share">
                  <a class="icon-twitter" href="https://twitter.com/share?text=Testing and Contributing with Composer Packages&amp;url=https://philsturgeon.uk/php/2013/05/01/testing-contributing-composer-packages/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                  <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                  </a>
                  <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=Testing and Contributing with Composer Packages&amp;u=https://philsturgeon.uk/php/2013/05/01/testing-contributing-composer-packages/"
                    onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                  <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                  </a>
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/devops/2013/04/26/vagrant-and-chef-upgrade-party/">Vagrant and Chef: Upgrade Party</a>
                </p>
                <p style="float:right">
                    Next: 
                    <a class="button" href="/devops/2013/05/05/build-your-own-vagrant-boxes-with-veewee/">Build your own Vagrant Boxes with VeeWee</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">Phil has contributed to CodeIgniter, FuelPHP, Laravel and handfuls of other projects, to try and make the PHP community a better place.</p>
              <hr>
              <p class="published">Published <time datetime="2013-05-01 18:24:00 UTC">2013-05-01 18:24:00 UTC</time></p>
            </section>
          </div>
          <div class="isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <footer class="site-footer">
              <h4>Build APIs You Won't Hate</h4>
              <p>Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a></p>
              <hr>
              <p class="published">Published 01 Feb 2014</p>
            </footer>
          </div>
        </div>
      </article>


    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/ciderphpants.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/'>GitHub</a>
      </li>
      <li>
        <a href='http://phptownhall.com/'>PHP Town Hall</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/http/2015/09/03/auto-incrementing-to-destruction/">Auto-Incrementing IDs: Giving your Data Away</a></li>
          <li><a href="/charity/2015/08/20/no-booze/">No Booze for a Month</a></li>
          <li><a href="/feminism/2015/08/17/women-speaker-ratio-conversation-loop/">The Ratio of Women Speakers in Tech</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
