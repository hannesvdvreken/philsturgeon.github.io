<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>PSR-2 v CodeSniffer PSR-2: A Success Story | Phil Sturgeon</title>
  <meta name="description" content="I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.png" rel="icon" type="image/png" />

  <meta property="og:title" content="PSR-2 v CodeSniffer PSR-2: A Success Story" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="I&#x27;ve had static analysis tools running in Sublime Text for a long time, but for most of that time I have had CodeSniffer and it&#x27;s PSR-2 rules disabled. I couldn&#x27;t for the life of me remember why I had done that, until I turned it back on again. All of a sudden it started complaining about code that I had always considered to be perfectly compliant." />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/php/2013/10/15/psr2-v-codesniffer-psr2/" />
  <meta property="og:locale" content="en_GB" />
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="PSR-2 v CodeSniffer PSR-2: A Success Story | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/php/2013/10/15/psr2-v-codesniffer-psr2/">
  <meta name="twitter:description" content="I&#x27;ve had static analysis tools running in Sublime Text for a long time, but for most of that time I have had CodeSniffer and it&#x27;s PSR-2 rules disabled. I couldn&#x27;t for the life of me remember why I had done that, until I turned it back on again. All of a sudden it started complaining about code that I had always considered to be perfectly compliant.">
  <meta name="twitter:creator" content="@philsturgeon">
  
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">PSR-2 v CodeSniffer PSR-2: A Success Story</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2013-10-15 11:39:00 UTC">
                Oct 15 2013
              </time>
              <a href="/tags/psr2/">#psr2</a>
              <a href="/tags/php/">#php</a>
              <a href="/tags/php-fig/">#php-fig</a>
              <a href="/tags/codesniffer/">#codesniffer</a>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>I’ve had static analysis tools running in Sublime Text for a long time, but for most of that time I have had CodeSniffer and it’s PSR-2 rules disabled. I couldn’t for the life of me remember why I had done that, until I turned it back on again. All of a sudden it started complaining about code that I had always considered to be perfectly compliant.</p>

<p>It reminded me of multiple conversations I’ve had with others in the FIG and the community in general, about how CodeSniffer often enforces rules in the PSR-2 spec that do not exist, or were not what was meant when it was written.</p>

<p>Two months ago I set off on a mission, to get CodeSniffer in line with what PSR-2 really is.</p>

<h2 id="the-story">The Story</h2>

<p>As with anything I do, it started with an angry tweet:</p>

<blockquote class="twitter-tweet"><p>Right, I’ve had enough. PHP CodeSniffer is drunk if it thinks this is how PSR-2 works: <a href="http://t.co/2KtSY9cywU">pic.twitter.com/2KtSY9cywU</a></p>&mdash; Phil Sturgeon (@philsturgeon) <a href="https://twitter.com/philsturgeon/statuses/370657376699166720">August 22, 2013</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>This was initially based around one issue, which I call “The Multi-line Argument Issue”. In other words, this should be valid:</p>

<pre class="highlight php"><code>somefunction($foo, $bar, [
  // ...
]);
</code></pre>

<p>After talking to Greg Sherwood it was clear that he would not make changes to the PHP CodeSniffer ruleset without PSR-2 itself being changed to clarify the intentions, and the FIG has been pretty clear about the fact nobody wants to change PSRs once they have been approved.</p>

<p>So instead of throwing my toys out of the pram I decided to set out the milestones required to get this resolved.</p>

<ol>
  <li>Poll the group and ask if Errata sounds like a good idea (as initially suggested by Larry Garfield).</li>
  <li>Create a list of potential Errata for PSR-2.</li>
  <li>Pull Request the first piece of Errata for PSR-2.</li>
  <li>Get Greg to implement the change.</li>
  <li>Repeat until no more issues.</li>
</ol>

<p>The trouble is half of those things require two-week votes, so this was going to be a long process.</p>

<p>I created a <a href="https://groups.google.com/forum/?fromgroups=#!topic/php-fig/89he2UxZopk">Poll</a> in the FIG mailing list to see if people would be ok with the idea of allowing Errata in the PSR Meta Documents. This is a good way to get a few yes/nos and potentially have a discussion, which <a href="https://groups.google.com/d/msg/php-fig/lWA0nL_Rs3A/VxWstqQbLEQJ">happened</a> but was nothing major.</p>

<p>People seemed happy with the idea so I created a <a href="https://groups.google.com/d/msg/php-fig/qTROKw07848/oHrdnF_Y9fYJ">vote for Errata</a>.</p>

<p>The vote passed with 20 for and nobody against out of 27 people. Big success.</p>

<p>Three weeks passed at this point, and we’re only just decided that we’ll allow Errata to PSRs in general. So the next step was to actually implement the specific Errata for the number 1 discrepancy on my list: “The Multi-Line Argument”.</p>

<p>I created a <a href="https://groups.google.com/d/msg/php-fig/tcOfuWcKNdM/RWX3AzMgNK4J">poll</a> to work out which examples people felt were valid.</p>

<p>Everyone seemed to believe that this was/should be valid:</p>

<pre class="highlight php"><code>somefunction($foo, $bar, [
  // ...
]);
</code></pre>

<p>Some disagreed that the following was valid:</p>

<pre class="highlight php"><code>somefunction($foo, $bar, [
  // ...
], $ban);
</code></pre>

<p>But the majority spoke and I used the poll as a basis for the pull request, which then went to a <a href="https://groups.google.com/d/msg/php-fig/-7iArK7WZA0/6MmXRIWGPIMJ">vote</a>.</p>

<p>The vote passed and two months later PHP CodeSniffer 1.4.7 was a thing, containing all of these changes!</p>

<h2 id="next-steps">Next Steps</h2>

<p>CodeSniffer’s PSR-2 support is far from perfect. While reporting discrepancies I discovered a few bugs, and from generally tweeting about this stuff I had reports of other issues where CodeSniffer would complain about things that it should have no reason to care about.</p>

<p>I constructed a <a href="https://gist.github.com/philsturgeon/6320152#file-3-comment-indentation-md">PSR-2 v CodeSniffer PSR-2 gist</a>, where people could discuss these issues and report new ones. We’re up to 5 and most of them have been fixed in 1.4.7, but we have two left.</p>

<p>For example, <a href="https://gist.github.com/philsturgeon/6320152#file-3-comment-indentation-md">Comment Alignment</a> is an ongoing discussion but a few people have simply said that CodeSniffer should just ignore comments and let people put them wherever they want. If PSR-2 doesn’t say it, CodeSniffer shouldn’t flag it.</p>

<h2 id="why-bother">Why Bother?</h2>

<p>I care because despite the occasionally tricky wording, PSR-2 is actually a nice standard. Hindsight says that chunks of PSR-2 could have been a lot better, but I was around just in time for the vote and my first few reads through never made me consider these things issues. It’s often only during the implementation that these things come out, and CodeSniffer is an implementation. This is essentially why I <a href="http://www.reddit.com/r/PHP/comments/1nks5e/ps4_voting_has_been_pulled_voting_is_closed_and/">pulled the PSR-4 vote</a> at the last minute, because the FIG needs to focus on getting wording as accurate as it possibly can.</p>

<p>This was a huge investment of time and effort, taking the votes, polls, moderating discussions, etc and it is not done yet, but it is all worth it.</p>

<p>My girlfriend has several times complained about me arguing on the internet (yes, that XKCD comic is my life) but I feel happy that these issues have been resolved;</p>

<ul>
  <li>I can now follow PSR-2 without defining a custom ruleset.</li>
  <li>My employees can now follow PSR-2 without me having to show them how to define a custom ruleset.</li>
  <li>Several people who hate PSR-2 might now realise it’s not that bad.</li>
  <li>If they stop hating on PSR-2 so hard, they’ll pay attention to other/future PSRs.</li>
  <li>We now have a process for fixing future confusion over potentially badly worded sentences (but we should obviously try to word things better in the first place).</li>
</ul>

<p>If you spot any more discrepancies get in touch on <a href="http://twitter.com/philsturgeon">Twitter</a> or in the comments, but if you suggest we make an errata item to allow tabs instead of spaces I will swing the ban-hammer hard.</p>

          
        </section>
        <footer class="post-footer">
            <section class="share">
                  <a class="icon-twitter" href="https://twitter.com/share?text=PSR-2 v CodeSniffer PSR-2: A Success Story&amp;url=https://philsturgeon.uk/php/2013/10/15/psr2-v-codesniffer-psr2/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                  <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                  </a>
                  <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=PSR-2 v CodeSniffer PSR-2: A Success Story&amp;u=https://philsturgeon.uk/php/2013/10/15/psr2-v-codesniffer-psr2/"
                    onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                  <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                  </a>
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/php/2013/09/12/solving-the-php-internals-workflow/">Solving the PHP Internals Workflow</a>
                </p>
                <p style="float:right">
                    Next: 
                    <a class="button" href="/php/2013/11/08/build-apis-part-1-useful-database-seeding/">Build API's That You Wont Hate: Part 1 - Useful Database Seeding</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">I spend a lot of time urging people to learn more languages, and if that is a bit much learn another framework. Rails and Laravel are the same, and Go is a barrel of laughs.</p>
              <p>Get out of your rut.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';

          var disqus_identifier = 'psr2-v-codesniffer-psr2';

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/ciderphpants.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/'>GitHub</a>
      </li>
      <li>
        <a href='http://phptownhall.com/'>PHP Town Hall</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/2016/01/04/http-rest-api-file-uploads/">HTTP/REST API File Uploads</a></li>
          <li><a href="/2015/11/20/deploying-with-git-flow-tags-and-circleci/">Deploying with Git-Flow, Tags and CircleCI</a></li>
          <li><a href="/api/2015/10/08/http-documentation-with-api-blueprint/">HTTP Documentation with API Blueprint</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
