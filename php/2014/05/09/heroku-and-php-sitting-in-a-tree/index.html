<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Heroku and PHP Sitting in a Tree. K.I.S.S.I.N.G | Phil Sturgeon</title>
  <meta name="description" content="I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.png" rel="icon" type="image/png" />

  <meta property="og:title" content="Heroku and PHP Sitting in a Tree. K.I.S.S.I.N.G" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="Heroku was - as far as I remember - the first (mainstream) PaaS on the market. It was Ruby-only but it was that symbol of modern web development at the time, with the whole “slinging code”, “getting shit done”, make a Git repo and start shipping bro, hack project&#x2F;agile-til-it-works mindset." />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/php/2014/05/09/heroku-and-php-sitting-in-a-tree/" />
  <meta property="og:locale" content="en_GB" />
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="Heroku and PHP Sitting in a Tree. K.I.S.S.I.N.G | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/php/2014/05/09/heroku-and-php-sitting-in-a-tree/">
  <meta name="twitter:description" content="Heroku was - as far as I remember - the first (mainstream) PaaS on the market. It was Ruby-only but it was that symbol of modern web development at the time, with the whole “slinging code”, “getting shit done”, make a Git repo and start shipping bro, hack project&#x2F;agile-til-it-works mindset.">
  <meta name="twitter:creator" content="@philsturgeon">
  
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Heroku and PHP Sitting in a Tree. K.I.S.S.I.N.G</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2014-05-09 12:54:00 UTC">
                May  9 2014
              </time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>Heroku was - as far as I remember - the first (mainstream) PaaS on the market. It was Ruby-only but it was that symbol of modern web development at the time, with the whole “slinging code”, “getting shit done”, make a Git repo and start shipping bro, hack project/agile-til-it-works mindset.</p>

<p>I made a few Rails apps back in the day, one of them being <a href="http://travlrapp.com/">Travlr</a> (which I should probably take down) and more recently <a href="http://techcrunch.com/2011/01/13/bieberly-justin-bieber/">Bieber.ly</a> and it was always amazing to work with. Git push your code, its deployed, one-click installs and drag to scale. It sucked that it was always for Ruby, because as I was also doing a <em>lot</em> of work in PHP I obviously wished I could have the same for my other projects.</p>

<p>Then PHP-Fog (later rebranded as App Fog) came along, with the slogan “Heroku for PHP!” I got excited and started using it - immediately taking my blog over to them and putting a few simple new client applications on there, but it was early days and it didn’t do as much. It was ok, but it wasn’t amazing. The scaling would sometimes take a REALLY long time and it would essentially delete your app and install a new copy, losing any temporary data. There was also no way to SSH in and download stuff or tweak anything or do… anything that you realistically wanted to do.</p>

<p>Orchestra.io came along, and the founder <a href="https://twitter.com/EamonLeonard">Eamon Leonard</a> was kind enough to give me a demo of the early versions. Again, it was early, but it didn’t seem to do as much as PHP Fog did, which was already less than I wanted.</p>

<p><a href="https://pagodabox.com/">Pagodabox</a> came along and offered a <em>lot</em> more functionality. It was amazing. It had instant scaling up and down, both horizontally and vertically, it offered all sorts of caching options and had SSH access so you could rsync any user generated content down and make backups. (Yes, you should use S3 or something, but try telling that to clients using old shitty CMSs that don’t support it). Pagodabox was amazing, so I moved my blog to it, and put a few simple client projects up there.</p>

<p>Heroku then started offering official support for Python, Node, Java… a <em>bunch</em> of platforms but… not PHP. I mean, you could kinda hack it in there but the platform was shitty and setup was a combination of weird commands. It was a second class citizen only supported by third-party buildpacks like the -incredibly good -  <a href="https://github.com/CHH/heroku-buildpack-php">CHH</a> buildpack. I played around with it a bit, but continued to wait for PHP support before moving anything substantial over there.</p>

<p>Orchestra.io then was <a href="http://techcrunch.com/2011/08/23/engine-yard-acquires-orchestra-to-add-php-support-to-its-paas/">acquired by EngineYard</a>, Heorku’s biggest competitor. Woah! I hoped Heroku would get going with PHP properly then, but no… ahh sod it though,we still have these other three options to play with. Right?</p>

<p>With these options available I optimistically called 2012 <a href="/blog/2012/01/2012-the-year-of-php-cloud-hosting">The Year of PHP Cloud Hosting</a>. By the end of the year I was <a href="/blog/2012/10/cloud-hosting-php-pipe-dream">calling myself a fool</a> for ever thinking it could be done properly.</p>

<p>Pagodabox was the most feature complete, but as stable as a wet fart. PHP Fog stopped having work done as App Fog came along, and App Fog just seemed to be missing crucial features. A few other options came and went within the space of a few months and some were always there but… there were a lot of shit options around.</p>

<p>It seemed like a lot of these companies were making these platforms for the sake of making them, and not really understanding the problem space properly.</p>

<p><a href="http://fortrabbit.com">Fortrabbit</a> was the savior for the last year and they’ve been a big hit in the Laravel community, but they sadly do not have all that many addons and compared to some other hosting solutions (and some of their since failed competition) they felt a little on the expensive side.</p>

<p>The only time I got to use Heroku properly recently was when me and <a href="http://twitter.com/zackkitzmiller">Zack</a> built <a href="http://madeinproduction.com">madeinproduction.com</a> with Python/Flask. I still missed it.</p>

<p>Then guess who came along?</p>

<p><a href="https://blog.heroku.com/archives/2014/4/29/introducing_the_new_php_on_heroku">BLOODY HEROKU DID!</a></p>

<p>Heroku hired <a href="https://twitter.com/dzuelke">David Zuelke</a> to help them bring PHP onto the platform as an officially supported language. I’d seen his name around GitHub plenty whilst working with the CHH buildpack and a few other pieces, and I knew this would be a good sign. A few months later there was a private beta, and now PHP is public beta on Heroku.</p>

<p><img alt="WINNING" src="http://www.reactiongifs.com/r/yay.gif" /></p>

<p>It took me longer to write this blog than it did to migrate this <a href="http://pyrocms.com">PyroCMS</a>-based blog to Heroku.</p>

<p>PyroCMS 2.2 is a little old now, and it only supports MySQL. Luckily 2.3 will be out soon which supports PostgreSQL and SQLite too, but in the mean-time I just added the <a href="https://addons.heroku.com/cleardb">ClearDB MySQL Addon</a> and I’m up and running. It took me literally about 10 minutes.</p>

<p>I create the app on Heroku through their web interface.</p>

<p>I had to link my local codebase to a Heroku app.</p>

<blockquote>
  <p>$ git remote add heroku git@heroku.com:philsturgeon.git</p>
</blockquote>

<p>Logged into heroku on the command line. If you don’t have the command-line app you will want to <a href="https://devcenter.heroku.com/articles/quickstart">install that</a>.</p>

<blockquote>
  <p>$ heroku login</p>
</blockquote>

<p>Pick an SSH key to add to your account. (No waiting 5-15 minutes like most other PHP PaaS systems, this one is instant.)</p>

<blockquote>
  <p>$ heroku keys:add</p>
</blockquote>

<p>Added a database (for free, up to 5mb).</p>

<blockquote>
  <p>$ heroku addons:add clearedb</p>
</blockquote>

<p>Updated my system/cms/database.php to use the ENV variable they set pointing to the database. Make your own system/cms/development/database.php to override this with your local MySQL config.</p>

<div class="highlight php"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="s1">'BASEPATH'</span><span class="p">))</span> <span class="k">exit</span><span class="p">(</span><span class="s1">'No direct script access allowed'</span><span class="p">);</span>

<span class="nv">$url</span> <span class="o">=</span> <span class="nb">parse_url</span><span class="p">(</span><span class="nb">getenv</span><span class="p">(</span><span class="s2">"CLEARDB\_DATABASE\_URL"</span><span class="p">));</span>

<span class="c1">// Staging and Production
</span><span class="nv">$db</span><span class="p">[</span><span class="s1">'default'</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">'hostname'</span>		<span class="o">=&gt;</span> 	<span class="nv">$url</span><span class="p">[</span><span class="s2">"host"</span><span class="p">],</span>
    <span class="s1">'username'</span>		<span class="o">=&gt;</span> 	<span class="nv">$url</span><span class="p">[</span><span class="s2">"user"</span><span class="p">],</span>
    <span class="s1">'password'</span>		<span class="o">=&gt;</span> 	<span class="nv">$url</span><span class="p">[</span><span class="s2">"pass"</span><span class="p">],</span>
    <span class="s1">'database'</span>		<span class="o">=&gt;</span> 	<span class="nb">substr</span><span class="p">(</span><span class="nv">$url</span><span class="p">[</span><span class="s2">"path"</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">'dbdriver'</span> 		<span class="o">=&gt;</span> 	<span class="s1">'mysqli'</span><span class="p">,</span>
    <span class="s1">'active_r'</span> 		<span class="o">=&gt;</span>	<span class="kc">true</span><span class="p">,</span>
    <span class="s1">'pconnect'</span> 		<span class="o">=&gt;</span>	<span class="kc">false</span><span class="p">,</span>
    <span class="s1">'db_debug'</span> 		<span class="o">=&gt;</span>	<span class="kc">true</span><span class="p">,</span>
    <span class="s1">'cache_on'</span> 		<span class="o">=&gt;</span>	<span class="kc">false</span><span class="p">,</span>
    <span class="s1">'char_set'</span> 		<span class="o">=&gt;</span>	<span class="s1">'utf8'</span><span class="p">,</span>
    <span class="s1">'dbcollat'</span> 		<span class="o">=&gt;</span>	<span class="s1">'utf8_unicode_ci'</span><span class="p">,</span>
<span class="p">);</span>

<span class="c1">// Assign the group to be used
</span><span class="nv">$active_group</span> <span class="o">=</span> <span class="s1">'default'</span><span class="p">;</span>
</pre></td></tr></tbody></table>
</div>

<p>They need a composer.json in there and PyroCMS 2.2 doesn’t have one. (<a href="https://github.com/pyrocms/pyrocms/blob/2.3/develop/composer.json">PyroCMS 2.3 does</a>.)</p>

<blockquote>
  <p>$ touch composer.json &amp;&amp; git add composer.json</p>
</blockquote>

<p>Set the <code>PYRO_ENV</code> to be production, so it doesn’t try using your development config.</p>

<blockquote>
  <p>$ heroku config:set PYRO_ENV=’production’</p>
</blockquote>

<p>Push all of that stuff up to Heroku.</p>

<blockquote>
  <p>$ git commit -am “Added all the heroku-related changes”
$ git push heroku master</p>
</blockquote>

<p>TADAAAAAAAAA.</p>

<p>My PyroCMS 2.2 blog here is now running on Heroku. I finally get to check that off my todo list.</p>

<p>Still on the list is:</p>

<ul>
  <li>“Upgrade to 2.3.0-beta1 as soon as its out”</li>
  <li>“Convert to PostgreSQL because its web-scale”</li>
  <li>“Blog about all of it properly”</li>
</ul>

<p>Heroku is an awesome solution because not only do they properly understand the problem, but they have been doing this for <em>years</em>. They’ve been around since 2007 so they completely understand how to set up simple hosting, from the basic blog to <a href="http://12factor.net">The Twelve Factor App</a>, which if we’re honest, is becoming more and more common these days, especially with all these people going around telling you to build API-first and API-centric applications… <em>cough</em></p>

        </section>
        <footer class="post-footer">
            <section class="share">
                  <a class="icon-twitter" href="https://twitter.com/share?text=Heroku and PHP Sitting in a Tree. K.I.S.S.I.N.G&amp;url=https://philsturgeon.uk/php/2014/05/09/heroku-and-php-sitting-in-a-tree/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                  <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                  </a>
                  <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=Heroku and PHP Sitting in a Tree. K.I.S.S.I.N.G&amp;u=https://philsturgeon.uk/php/2014/05/09/heroku-and-php-sitting-in-a-tree/"
                    onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                  <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                  </a>
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/2014/05/07/the-tale-of-tom-dick-and-harry/">The Tale of Tom, Dick and Harry</a>
                </p>
                <p style="float:right">
                    Next: 
                    <a class="button" href="/rest/2014/05/11/restful-urls-actions-need-not-apply/">RESTful URLs: Actions Need Not Apply</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">Phil has contributed to CodeIgniter, FuelPHP, Laravel and handfuls of other projects, to try and make the PHP community a better place.</p>
              <hr>
              <p class="published">Published <time datetime="2014-05-09 12:54:00 UTC">May  9 2014</time></p>
            </section>
          </div>
          <div class="isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <footer class="site-footer">
              <h4>Build APIs You Won't Hate</h4>
              <p>Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a></p>
              <hr>
              <p class="published">Published Feb 1 2014</p>
            </footer>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';

          var disqus_identifier = 'heroku-and-php-sitting-in-a-tree';

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/ciderphpants.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/'>GitHub</a>
      </li>
      <li>
        <a href='http://phptownhall.com/'>PHP Town Hall</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/http/2015/09/03/auto-incrementing-to-destruction/">Auto-Incrementing IDs: Giving your Data Away</a></li>
          <li><a href="/charity/2015/08/22/no-booze/">No Booze for a Month</a></li>
          <li><a href="/feminism/2015/08/17/women-speaker-ratio-conversation-loop/">The Ratio of Women Speakers in Tech</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
