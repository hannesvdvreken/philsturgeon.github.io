<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>RESTful Deletions, Restorations and Revisions | Phil Sturgeon</title>
  <meta name="description" content="I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link href="/stylesheets/main.css" rel="stylesheet" media="screen" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href="/images/favicon.png" rel="icon" type="image/png" />

  <meta property="og:title" content="RESTful Deletions, Restorations and Revisions" />
  <meta property="og:type" content="article" />
  <meta property="article:author" content="Phil Sturgeon" />
  <meta property="og:description" content="A friend asked me for some advice on how to approach building article revisions and restoring deleted content from API in a RESTful way. With most things, it didn&#x27;t fit on Twitter, so I promised him a blog. " />
  <meta property="og:site_name" content="Phil Sturgeon" />
  <meta property="og:image" content="https://philsturgeon.uk/images/author.jpg" />
  <meta property="og:url" content="https://philsturgeon.uk/rest/2014/05/25/restful-deletions-restorations-and-revisions/" />
  <meta property="og:locale" content="en_GB" />
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@philsturgeon">
  <meta name="twitter:title" content="RESTful Deletions, Restorations and Revisions | Phil Sturgeon">
  <meta name="twitter:image:src" content="https://philsturgeon.uk/images/author.jpg">
  <meta name="twitter:url" content="https://philsturgeon.uk/rest/2014/05/25/restful-deletions-restorations-and-revisions/">
  <meta name="twitter:description" content="A friend asked me for some advice on how to approach building article revisions and restoring deleted content from API in a RESTful way. With most things, it didn&#x27;t fit on Twitter, so I promised him a blog. ">
  <meta name="twitter:creator" content="@philsturgeon">
  
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
</head>


  <body>

    <a class='fa fa-home logo-readium' href='/'></a>


    <!-- content start -->

    <main class="content" role="main">
      <article class="post">
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">RESTful Deletions, Restorations and Revisions</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person">Phil Sturgeon</h4>
              on
              <time datetime="2014-05-25 14:20:00 UTC">
                May 25 2014
              </time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>Two weeks ago I posted <a href="/blog/2014/05/restful-urls-actions-need-not-apply">RESTful URLs: Actions Need Not Apply</a> which was all about how the only action/verb to appear in the HTTP Request should be the HTTP Method itself (GET, POST, PUT, DELETE, HEAD, etc).</p>

<p>This was figured out as myself and others were working on complex use-cases which aren’t the usual “apples” and “pears” crap a lot of API design material is based around. Simple APIs are simple, but trying to figure out “How do I make it RESTful” on more complex stuff like mass message sending can break your brain.</p>

<p>Now that I’m “The REST Guy” to some in the PHP community, I’ve been getting a few questions about how to approach other challenges.</p>

<p>The rules are:</p>

<ul>
  <li>No verbs in the URL</li>
  <li>Input should look as much like output as possible</li>
  <li>Do not invent fields that only exist for input</li>
  <li>Use each HTTP method for its exact intended purpose</li>
</ul>

<p>So, lets go!</p>

<h2 id="deleting-then-undeleting">Deleting, then… undeleting?</h2>

<blockquote class="twitter-tweet" lang="en"><p>Hey <a href="https://twitter.com/philsturgeon">@philsturgeon</a> - what&#39;s the &quot;most RESTful&quot; way to restore/undelete a resource?</p>&mdash; Christopher Pitt (@followchrisp) <a href="https://twitter.com/followchrisp/statuses/469477939101597696">May 22, 2014</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Chris had a set of routes like this:</p>

<ul>
  <li>GET articles</li>
  <li>POST articles</li>
  <li>PATCH articles/{article}</li>
  <li>DELETE articles/{article}</li>
</ul>

<p>Pretty straight forward so far right? Get them all, create one, update an existing one and delete one. Cool.</p>

<p>What happens if you want to restore a deleted article?</p>

<p>Obviously if you have actually deleted it from the database (hard-delete) then tough cheese, but if the record exists in there somewhere
with a changed status or a deleted_at field like in Laravel (soft-delete) then you can do this easily enough.</p>

<p>The two approaches I can see that follow all of the rules are this:</p>

<h3 id="archive-then-hard-delete">Archive then Hard-Delete</h3>

<p>Delete should probably do what it says, actually delete the item. If delete is a destructive and unrecoverable action, then you will need to invent some other status for the article to exist in, which is still hidden from the API but not entirely gone from the database.</p>

<pre class="highlight http"><code><span class="err">PATCH /articles/foo HTTP/1.1  
Host: api.example.com  
Content-Type: application/json  

{ "status" : "archived" }  
</span></code></pre>

<p>This would keep it available everywhere in the API, and you could get it if you wanted, or ignore it with filters. For example, running a <code>GET /articles?status=archived</code> could very easily get you archived items, and running <code>GET /articles?status=published</code> would get you the live ones.</p>

<p>Making a <code>GET</code> request to an archived item still works fine, but you see <code>"status" : "archived"</code> in the body.</p>

<p>If you then want to actually remove something from the system then you could use <code>DELETE /articles/foo</code> to remove it entirely.</p>

<h2 id="soft-delete-and-restore">Soft-Delete and Restore</h2>

<p>In this approach we use <code>DELETE</code> to delete stuff and do not play around with a status field initially.</p>

<p>Once you delete it, it is gone. It will not show up in <code>GET /articles</code> regardless of any filter provided. If you try and call it up you get a 404 or a 410.</p>

<p>This article is no longer amongst the general population of the API.</p>

<p>To win the game we need some way to see “deleted” content and restore them so maybe… just maybe <code>GET /articles/trashed</code>.</p>

<p>The reason I think this works is because trashed items are a specific sub-set of articles. It does not just use a filter - because those articles are gone as far as the rest of the API is concerned - they are in a whole different place, and therefore a new resource with a new collection makes sense.</p>

<p>One you have found the item you could once again <code>PATCH</code> the status to <code>"published"</code> (or whatever):</p>

<pre class="highlight http"><code><span class="err">PATCH /articles/trashed/foo HTTP/1.1  
Host: api.example.com  
Content-Type: application/json  

{ "status" : "published" }  
</span></code></pre>

<p>Alternatively you could use some sort of <code>is_trash</code> boolean field which always shows when you <code>GET</code> something, trash or not, then use <code>PATCH</code> with a body like <code>"is_trash" : false</code> to restore it. Regardless of choosing a bool field or a status field, patching it seems to work.</p>

<h3 id="which-to-use">Which to use?</h3>

<p>I think I personally prefer the first approach. To me, a delete means delete. It’s the most semantic. If your application is not actually deleting stuff then calling any of it delete is misleading.</p>

<p>Offering a way to “Trash” or “Archive” or “Ban” a resource by changing the status of the resource seems incredibly semantic too.</p>

<h2 id="multiple-revisions">Multiple Revisions</h2>

<p>Another thing Chris asked about was how to promote and demote various revisions that relate to an article.</p>

<p>He has these routes:</p>

<ul>
  <li>GET articles/{article}/revisions</li>
  <li>POST articles/{article}/revisions</li>
  <li>PATCH articles/{article}/revisions/{article-revision}</li>
  <li>DELETE articles/{article}/revisions/{article-revision}</li>
</ul>

<p>One rule mentioned above is:</p>

<ul>
  <li>Input should look as much like output as possible</li>
</ul>

<p>To me, it would be pretty handy if all revisions had a <code>"is_current"</code> value to let me know if this was the current revision. You can 
add new ones and they might be promoted to the current automatically, or somebody might want to roll back the revision through an interface somewhere, but whatever happens the interface and the output will need to highlight the current revision.</p>

<p><em><strong>Aside:</strong> This does not mean you literally need a field in the database called <code>is_current</code>. Maybe your articles table has a <code>revision_id</code> field in there pointing to the current revision in use. Your JSON input and output should not be a direct mapping or your SQL schema, so do not feel obliged to make this field.</em></p>

<p>Because we have that field as output, it should not be that much of a stretch to assume we can PATCH on it.</p>

<p>If article <code>foo</code> has three revisions, this should be possible to make revision 2 the current revision:</p>

<pre class="highlight http"><code><span class="err">PATCH /articles/foo/revisions/2 HTTP/1.1  
Host: api.example.com  
Content-Type: application/json  

{ "is_current" : true }  
</span></code></pre>

<p>At that point maybe your internal logic updates that revision record with a <code>true</code> and set the other revisions for that article to be <code>false</code>, or maybe you go and update the articles table and set the <code>revision_id</code> to the ID provided. Whatever you do, this will now effect which is the current promoted revision and we’ve not had to make anything gross like <code>/articles/foo/revisions/promote/34</code> which I have seen suggested before.</p>

<h2 id="summary">Summary</h2>

<p>As I have said before, sometimes trying to make things RESTful for the sake of it is more a religious choice than a technical one. In some instances the most RESTful way is not initially the most obvious way, but that is only down to a decade of us being taught that shit like <code>/articles/foo/revisions/promote/34</code> is helpful. Maybe for a website, but a RESTful API is a platform of never-ending possibilities and not just a collection of functions with custom parameters like XML-RPC/SOAP. Once you start to grasp how this stuff works, a lot of the things that seemed pointless but RESTful actually start to seem much cleaner, and more flexible.</p>

        </section>
        <footer class="post-footer">
            <section class="share">
                  <a class="icon-twitter" href="https://twitter.com/share?text=RESTful Deletions, Restorations and Revisions&amp;url=https://philsturgeon.uk/rest/2014/05/25/restful-deletions-restorations-and-revisions/"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                  <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                  </a>
                  <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=RESTful Deletions, Restorations and Revisions&amp;u=https://philsturgeon.uk/rest/2014/05/25/restful-deletions-restorations-and-revisions/"
                    onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                  <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                  </a>
            </section>
            <section class="post-next-previous">
                <p>
                    Previous:
                    <a class="button" href="/rest/2014/05/11/restful-urls-actions-need-not-apply/">RESTful URLs: Actions Need Not Apply</a>
                </p>
                <p style="float:right">
                    Next: 
                    <a class="button" href="/php/2014/05/29/fractal-v080-now-with-serializers/">Fractal v0.8.0, now with Serializers</a>
                </p>
            </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="more isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/images/author.jpg)">Blog Logo</div>
              <h4>Phil Sturgeon</h4>
              <p class="bio">I spend a lot of time urging people to learn more languages, and if that is a bit much learn another framework. Rails and Laravel are the same, and Go is a barrel of laughs.</p>
              <p>Get out of your rut.</p>
            </section>
          </div>
          <div class="more isRight">
            <h5 class="index-headline featured"><span>More Writing</span></h5>
            <section class="author">
              <a href="http://apisyouwonthate.com/">
                <div class="book-image build-apis">Book Cover</div>
                <h4>Build APIs You Won't Hate</h4>
              </a>
              <p class="bio">Everyone and their dog wants an API, so you should probably learn how to build them.</p>
              <p><a href="http://apisyouwonthate.com/">Buy it from LeanPub or Amazon</a>.</p>
            </section>
          </div>
        </div>
      </article>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'philsturgeon';

          var disqus_identifier = 'restful-deletions-restorations-and-revisions';

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </main>
    <div class="bottom-closer">
      <div class="background-closer-image" style="background-image: url(/images/ciderphpants.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Phil Sturgeon</h1>
        <h2 class="blog-description">I used to contribute to the PHP-FIG, The League of Extraordinary Packages, PHP The Right Way, CodeIgniter, FuelPHP, PyroCMS and a bunch of other stuff, but I gave it all up to join the circus</h2>
        <a href="/" class="btn">Back to Overview</a>
      </div>
    </div>

    <!-- content end -->

    <footer class='footer' role='contentinfo'>
  <div class='footer-links'>
    <ul class='context'>
      <li>
        <h3>Content</h3>
      </li>
      <li>
        <a href='/about'>About</a>
      </li>
      <li>
        <a href='/books'>Books</a>
      </li>
    </ul>
    <ul class='follow'>
      <li>
        <h3>Follow Me</h3>
      </li>
      <li>
        <a href='https://twitter.com/philsturgeon'>Twitter</a>
      </li>
      <li>
        <a href='https://github.com/'>GitHub</a>
      </li>
      <li>
        <a href='http://phptownhall.com/'>PHP Town Hall</a>
      </li>
    </ul>
    <ul class='recent_posts'>
      <li>
        <h3>Recent Posts</h3>
        <ul>
          <li><a href="/api/2015/10/08/http-documentation-with-api-blueprint/">HTTP Documentation with API Blueprint</a></li>
          <li><a href="/2015/10/02/everyones-favourite-twitter-character/">Everyones Favourite Twitter Characters</a></li>
          <li><a href="/http/2015/09/23/http-status-codes-are-not-enough/">HTTP Status Codes Are Not Enough</a></li>
        </ul>
      </li>
    </ul>
  </div>
</footer>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="/javascripts/jquery.fitvids.js"></script>
<script src="/javascripts/index.js"></script>
<script src="/javascripts/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    $window.on('scroll', function() {
      var top = $window.scrollTop();

      if (top < 0 || top > 1500) { return; }
      $image
        .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
        .css('opacity', 1-Math.max(top/700, 0));
    });
    $window.trigger('scroll');

    var height = $('.article-image').height();
    $('.post-content').css('padding-top', height + 'px');

    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
       && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({ scrollTop: target.offset().top }, 500);
          return false;
        }
      }
    });
  });
}(jQuery));
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-8523256-1', 'auto');
  ga('send', 'pageview');

</script>


  </body>

</html>
